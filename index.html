<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pixel Garden: Tokyo Time</title>
   <style>
    /* 1. å¼•å…¥åƒç´ å­—ä½“ (è°·æ­Œå­—ä½“åº“) */
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    :root {
        /* æ˜Ÿéœ²è°·é…è‰²ç›˜ */
        --sky-day: #87CEEB;
        --sky-dusk: #ff9966;
        --sky-night: #2c2c54;
        
        /* åœ°é¢ä¸å†æ˜¯æ­»æ¿çš„ç»¿ï¼Œè€Œæ˜¯æš–è‰²è°ƒçš„è‰åœ° */
        --grass-light: #76c043;
        --grass-dark: #5dae2d;
        
        /* æœ¨å¤´ UI é¢œè‰² */
        --wood-light: #e0a968;
        --wood-main: #c47e33;
        --wood-dark: #78481c;
        --wood-border: #4a2c10;
        
        --flower-color: #ffeb3b; 
    }

    body {
        margin: 0;
        overflow: hidden;
        background-color: var(--sky-day);
        /* è¿™é‡Œçš„å­—ä½“æ”¹äº†ï¼ */
        font-family: 'Press Start 2P', cursive; 
        transition: background-color 3s ease;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        user-select: none;
        /* ç»™æ•´ä¸ªç”»é¢åŠ ä¸€ç‚¹ç‚¹å¤å¤é¢—ç²’æ„Ÿ */
        background-image: radial-gradient(rgba(0,0,0,0) 2px, transparent 0);
        background-size: 4px 4px;
    }

    #game-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
    }

    /* === å¤ªé˜³æœˆäº® (åŠ äº†ä¸€åœˆåƒç´ è¾¹æ¡†) === */
    .celestial-body {
        position: absolute;
        top: 10%;
        right: 15%;
        width: 50px;
        height: 50px;
        background: #fff;
        /* åƒç´ é£æ ¼ä¸æ”¯æŒæ¨¡ç³Šé˜´å½±ï¼Œæ”¹ç”¨ç¡¬è¾¹é˜´å½± */
        box-shadow: 4px 4px 0 rgba(0,0,0,0.2); 
        transition: all 2s;
        border: 4px solid rgba(0,0,0,0.1); /* å¢åŠ åšé‡æ„Ÿ */
    }
    .sun { background: #ffe066; border-color: #ffcc00; }
    .moon { background: #f4f6f0; border-color: #d1d8e0; }

    /* === æå…‰ä¿æŒä¸å˜ === */
    .aurora {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 60%;
        background: linear-gradient(90deg, rgba(0,255,127,0) 0%, rgba(0,255,127,0.3) 50%, rgba(138,43,226,0) 100%);
        opacity: 0; transition: opacity 1s; pointer-events: none; z-index: 1;
    }
    .aurora.active { opacity: 1; animation: aurora-move 5s infinite linear; }
    @keyframes aurora-move { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

    /* === åœ°é¢ä¼˜åŒ–ï¼šæ›´æœ‰å±‚æ¬¡çš„è‰åœ° === */
    .ground {
        width: 100%;
        height: 140px;
        background-color: var(--grass-light);
        /* ç”¨ CSS æ¸å˜æ¨¡æ‹Ÿè‰åªçš„æ¡çº¹çº¹ç† */
        background-image: repeating-linear-gradient(
            45deg,
            var(--grass-light) 0px,
            var(--grass-light) 20px,
            var(--grass-dark) 20px,
            var(--grass-dark) 40px
        );
        border-top: 6px solid #3e6e1e; /* è‰åœ°æ·±è‰²è¾¹ç¼˜ */
        position: relative;
        z-index: 10;
        display: flex;
        justify-content: center;
        box-shadow: 0 -10px 20px rgba(0,0,0,0.1) inset;
    }

    /* === èŠ±ç›†/æ¤ç‰©åŒºåŸŸ === */
    .pot-area {
        position: absolute;
        bottom: 60px; /* ç¨å¾®æŠ¬é«˜ä¸€ç‚¹ */
        width: 200px;
        height: 300px;
        display: flex;
        justify-content: center;
        align-items: flex-end;
    }

    .pixel-art { image-rendering: pixelated; }

    /* æ¤ç‰©æ ·å¼ç¨å¾®åŠ ç²—è¾¹æ¡†ï¼Œæ›´åƒæ¸¸æˆé“å…· */
    .seed, .sprout, .stem-tall, .bud, .flower-head, .petal, .center {
        /* ç»™æ‰€æœ‰æ¤ç‰©å…ƒç´ åŠ ä¸Šé»‘è‰²æè¾¹ */
        box-shadow: 2px 2px 0 rgba(0,0,0,0.2); 
    }
    
    .seed { width: 20px; height: 12px; background: #8d6e63; border-radius: 50%; position: relative; }
    .zzz { position: absolute; top: -20px; right: -10px; font-size: 20px; color: #fff; opacity: 0; animation: float-zzz 2s infinite; }
    .sprout { width: 8px; height: 30px; background: #8bc34a; position: relative; }
    .sprout::before { content: ''; position: absolute; top: 0; left: -10px; width: 10px; height: 10px; background: #8bc34a; border-radius: 10px 0 10px 0; }
    .sprout::after { content: ''; position: absolute; top: 5px; right: -10px; width: 10px; height: 10px; background: #8bc34a; border-radius: 0 10px 0 10px; }
    
    .stem-tall { width: 10px; height: 100px; background: #66bb6a; position: relative; }
    .stem-tall::before, .stem-tall::after { content: ''; position: absolute; background: #66bb6a; width: 20px; height: 20px; }
    .stem-tall::before { top: 30%; left: -20px; border-radius: 20px 0 20px 0; }
    .stem-tall::after { top: 50%; right: -20px; border-radius: 0 20px 0 20px; }
    
    .bud { width: 24px; height: 30px; background: var(--flower-color); border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; border: 3px solid #333; position: absolute; top: -30px; left: -8px; }
    
    .flower-head { position: absolute; top: -50px; left: -26px; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; }
    .petal { position: absolute; width: 24px; height: 24px; background: var(--flower-color); border: 2px solid rgba(0,0,0,0.1); }
    .petal:nth-child(1) { top: 0; left: 20px; }
    .petal:nth-child(2) { bottom: 0; left: 20px; }
    .petal:nth-child(3) { left: 0; top: 20px; }
    .petal:nth-child(4) { right: 0; top: 20px; }
    .center { position: absolute; width: 24px; height: 24px; background: #5d4037; z-index: 2; border: 2px solid rgba(0,0,0,0.2); }

    .shake { animation: shake-anim 0.5s ease-in-out; }
    @keyframes shake-anim { 0% { transform: rotate(0deg); } 25% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0deg); } }
    @keyframes float-zzz { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 1; } 100% { opacity: 0; transform: translateY(-20px); } }

    /* è™«å­å’Œç‰¹æ•ˆ */
    .bug { position: absolute; width: 12px; height: 8px; background: #333; border-radius: 4px; cursor: pointer; z-index: 100; display: none; box-shadow: 2px 2px 0 rgba(0,0,0,0.2); }
    .bug::before { content: ''; position: absolute; top: -4px; left: 0; width: 4px; height: 4px; border-left: 1px solid #333; }
    .heart-bubble { position: absolute; color: #ff4081; font-size: 24px; animation: float-up 1.5s forwards; pointer-events: none; z-index: 200; text-shadow: 2px 2px 0 #fff; }
    @keyframes float-up { 0% { opacity: 1; transform: translateY(0) scale(0.5); } 100% { opacity: 0; transform: translateY(-50px) scale(1.5); } }

    /* === æ ¸å¿ƒæ”¹å˜ï¼šæ˜Ÿéœ²è°·é£æ ¼çš„æœ¨å¤´ UI === */
    .ui-bar {
        position: absolute;
        bottom: 20px;
        /* æœ¨å¤´çº¹ç†èƒŒæ™¯ */
        background-color: var(--wood-main);
        padding: 15px 25px;
        /* ç¡¬æœ—çš„åƒç´ è¾¹æ¡†ï¼šä¸Šå·¦äº®ï¼Œä¸‹å³æš—ï¼Œæ¨¡æ‹Ÿ 3D å‡¸èµ· */
        border-top: 4px solid var(--wood-light);
        border-left: 4px solid var(--wood-light);
        border-right: 4px solid var(--wood-border);
        border-bottom: 4px solid var(--wood-border);
        /* é˜´å½± */
        box-shadow: 6px 6px 0 rgba(0,0,0,0.3);
        
        display: flex;
        gap: 20px;
        z-index: 20;
    }

    /* æŒ‰é’®å˜æˆæœ¨æ¿ä¸Šçš„å°æ ¼ */
    .btn {
        background: #e6ccb3; /* ç±³é»„è‰²çº¸å¼ æ„Ÿ */
        border: 3px solid var(--wood-border);
        border-radius: 0; /* åƒç´ ä¸éœ€è¦åœ†è§’ */
        padding: 10px 14px;
        cursor: pointer;
        font-size: 20px;
        transition: transform 0.1s;
        /* æŒ‰é’®å†…éƒ¨é˜´å½± */
        box-shadow: inset 3px 3px 0 rgba(255,255,255,0.5), inset -3px -3px 0 rgba(0,0,0,0.1);
    }
    .btn:hover { transform: scale(1.1); background: #fff; }
    .btn:active { transform: scale(0.95); background: #dcb; box-shadow: inset 3px 3px 0 rgba(0,0,0,0.2); }

    /* æ–‡å­—ä¿¡æ¯æ¡†å˜æˆå·è½´/æœ¨ç‰Œé£æ ¼ */
    .time-display, .stage-display {
        position: absolute;
        top: 20px;
        background: var(--wood-dark);
        color: #fff; /* è¿™é‡Œçš„æ–‡å­—é¢œè‰²æ”¹ä¸ºç»å…¸çš„æš–ç™½ */
        padding: 8px 12px;
        border: 3px solid #fff;
        font-size: 12px;
        box-shadow: 4px 4px 0 rgba(0,0,0,0.3);
        text-transform: uppercase; /* å…¨éƒ¨å¤§å†™ï¼Œæ›´åƒæ¸¸æˆ */
        line-height: 1.5;
    }
    .time-display { left: 20px; border-color: var(--wood-light); }
    .stage-display { right: 20px; border-color: var(--wood-light); text-align: right; }

    /* è¤ç«è™«æ ·å¼ (å¦‚æœä½ ä¹‹å‰åŠ äº†çš„è¯) */
    .firefly { position: absolute; width: 4px; height: 4px; background-color: #ccff00; border-radius: 0; box-shadow: 0 0 5px #ccff00; opacity: 0; pointer-events: none; z-index: 5; animation: float-firefly 10s infinite linear, blink-firefly 3s infinite ease-in-out; }
    @keyframes float-firefly { 0% { transform: translate(0, 0); } 25% { transform: translate(20px, -20px); } 50% { transform: translate(0, -40px); } 75% { transform: translate(-20px, -20px); } 100% { transform: translate(0, 0); } }
    @keyframes blink-firefly { 0%, 100% { opacity: 0; } 50% { opacity: 0.8; } }
</style>
</head>
<body>

    <div class="aurora" id="aurora"></div>

    <div id="game-container">
        <div class="time-display" id="clock">Loading...</div>
        <div class="stage-display" id="status">Checking Tokyo...</div>

        <div class="celestial-body" id="sun-moon"></div>

        <div id="bug-container"></div>

        <div class="pot-area">
            <div id="plant" class="pixel-art">
            </div>
        </div>

        <div class="ground"></div>

        <div class="ui-bar">
            <button class="btn" onclick="waterPlant()" title="æµ‡æ°´">ğŸ’§</button>
            <button class="btn" onclick="catchBugTrigger()" title="æ‰è™« (æ¨¡æ‹Ÿæµ‹è¯•ç”¨)">ğŸ•¸ï¸</button>
            <button class="btn" onclick="fertilize()" title="æ–½è‚¥">ğŸ§ª</button>
        </div>
    </div>

    <script>
        // === è¿™é‡Œæ˜¯ä½ åŸæœ¬çš„ JavaScript é€»è¾‘ ===
        // å¼ºåˆ¶ä½¿ç”¨ä¸œäº¬æ—¶é—´ (UTC+9)
        function getTokyoTime() {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            return new Date(utc + (3600000 * 9));
        }

        // æ¯æ—¥éšæœºèŠ±è‰²ç”Ÿæˆå™¨
        function getDailyColor() {
            const dateStr = getTokyoTime().toDateString();
            let hash = 0;
            for (let i = 0; i < dateStr.length; i++) {
                hash = dateStr.charCodeAt(i) + ((hash << 5) - hash);
            }
            // ç”ŸæˆæŸ”å’Œçš„éšæœºé¢œè‰²
            const hue = Math.abs(hash) % 360;
            return `hsl(${hue}, 70%, 60%)`;
        }

        // åº”ç”¨æ¯æ—¥é¢œè‰²
        document.documentElement.style.setProperty('--flower-color', getDailyColor());

        const plantEl = document.getElementById('plant');
        const sunMoonEl = document.getElementById('sun-moon');
        const bodyEl = document.body;
        const statusEl = document.getElementById('status');
        const clockEl = document.getElementById('clock');
        const auroraEl = document.getElementById('aurora');

        // === çŠ¶æ€å®šä¹‰ ===
        // 0: å¤œæ™š (19:00 - 10:00)
        // 1: èŒèŠ½ (10:00 - 12:00)
        // 2: æˆé•¿ (12:00 - 14:00)
        // 3: å«è‹ (14:00 - 16:00)
        // 4: ç››èŠ± (16:00 - 18:00)
        // 5: ç»“æœ (18:00 - 19:00)

        function updateGame() {
            const tokyoTime = getTokyoTime();
            const hours = tokyoTime.getHours();
            const minutes = tokyoTime.getMinutes();
            
            // æ›´æ–°æ—¶é’Ÿæ˜¾ç¤º
            clockEl.innerText = `Tokyo: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;

            let stage = 0;
            let bgType = 'night';

            if (hours >= 10 && hours < 12) { stage = 1; bgType = 'day'; }
            else if (hours >= 12 && hours < 14) { stage = 2; bgType = 'day'; }
            else if (hours >= 14 && hours < 16) { stage = 3; bgType = 'day'; }
            else if (hours >= 16 && hours < 18) { stage = 4; bgType = 'day'; }
            else if (hours >= 18 && hours < 19) { stage = 5; bgType = 'dusk'; }
            else { stage = 0; bgType = 'night'; } // 19:00 - 10:00

            renderEnvironment(bgType);
            renderPlant(stage);
        }

        function renderEnvironment(type) {
            if (type === 'day') {
                bodyEl.style.backgroundColor = 'var(--sky-day)';
                sunMoonEl.className = 'celestial-body sun';
            } else if (type === 'dusk') {
                bodyEl.style.backgroundColor = 'var(--sky-dusk)';
                sunMoonEl.className = 'celestial-body sun';
                sunMoonEl.style.top = '60%'; // å¤ªé˜³ä¸‹å±±
            } else {
                bodyEl.style.backgroundColor = 'var(--sky-night)';
                sunMoonEl.className = 'celestial-body moon';
                sunMoonEl.style.top = '10%';
            }
        }

        let currentRenderedStage = -1;

        function renderPlant(stage) {
            if (stage === currentRenderedStage) return; // é¿å…é‡å¤æ¸²æŸ“
            currentRenderedStage = stage;

            plantEl.innerHTML = ''; // æ¸…ç©º
            plantEl.className = 'pixel-art'; // é‡ç½®ç±»

            let html = '';
            let statusText = '';

            if (stage === 0) {
                // ç§å­ç¡è§‰
                html = `<div class="seed"><div class="zzz">zZ</div></div>`;
                statusText = 'Night: Sleeping...';
            } else if (stage === 1) {
                // èŒèŠ½
                html = `<div class="sprout"></div>`;
                statusText = '10:00 - Sprouting';
            } else if (stage === 2) {
                // æˆé•¿
                html = `<div class="stem-tall"></div>`;
                statusText = '12:00 - Growing';
            } else if (stage === 3) {
                // å«è‹
                html = `<div class="stem-tall"><div class="bud"></div></div>`;
                statusText = '14:00 - Budding';
            } else if (stage === 4) {
                // ç››å¼€
                html = `
                    <div class="stem-tall">
                        <div class="flower-head">
                            <div class="petal"></div><div class="petal"></div>
                            <div class="petal"></div><div class="petal"></div>
                            <div class="center"></div>
                        </div>
                    </div>`;
                statusText = '16:00 - Blooming!';
            } else if (stage === 5) {
                // ç»“æœ (èŠ±ç“£æ‰äº†ï¼Œå‰©ä¸ªé»‘æœå­)
                html = `<div class="stem-tall"><div class="seed" style="top:-10px; background:#3e2723;"></div></div>`;
                statusText = '18:00 - Fruiting';
            }

            plantEl.innerHTML = html;
            statusEl.innerText = statusText;
        }

        // === äº’åŠ¨åŠŸèƒ½ ===

        // 1. æµ‡æ°´
        function waterPlant() {
            triggerJoy();
        }

        // 2. æ–½è‚¥ (æå…‰)
        function fertilize() {
            auroraEl.classList.add('active');
            setTimeout(() => {
                auroraEl.classList.remove('active');
            }, 5000);
            triggerJoy();
        }

        // 3. æ‰è™«ç³»ç»Ÿ
        function bugSystem() {
            // æ¯éš” 10-30 ç§’å°è¯•ç”Ÿæˆè™«å­ (ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œæ¦‚ç‡è®¾é«˜ä¸€ç‚¹)
            setInterval(() => {
                const hour = getTokyoTime().getHours();
                if (hour < 10 || hour >= 19) return; // æ™šä¸Šæ²¡è™«å­
                
                if (Math.random() > 0.7 && document.querySelector('.bug') === null) {
                    spawnBug();
                }
            }, 10000);
        }

        function spawnBug() {
            const bug = document.createElement('div');
            bug.className = 'bug';
            bug.style.display = 'block';
            // éšæœºä½ç½®
            const randomBottom = Math.floor(Math.random() * 200) + 50; 
            const randomLeft = Math.floor(Math.random() * 100) - 50; 
            bug.style.bottom = randomBottom + 'px';
            bug.style.left = randomLeft + 'px'; // ç›¸å¯¹äºçˆ¶çº§
            
            bug.onclick = function(e) {
                e.stopPropagation(); // é˜²æ­¢ç‚¹åˆ°èƒŒæ™¯
                this.remove();
                triggerJoy();
            };

            plantEl.appendChild(bug);
        }
        
        // è°ƒè¯•ç”¨çš„æ‰‹åŠ¨åˆ·è™«å­æŒ‰é’®
        function catchBugTrigger() {
             spawnBug();
        }

        // é€šç”¨ï¼šå¼€å¿ƒç‰¹æ•ˆ
        function triggerJoy() {
            // 1. æŠ–åŠ¨
            const content = plantEl.firstElementChild;
            if(content) {
                content.classList.remove('shake');
                void content.offsetWidth; // è§¦å‘é‡ç»˜
                content.classList.add('shake');
            }

            // 2. å†’çˆ±å¿ƒ
            const heart = document.createElement('div');
            heart.className = 'heart-bubble';
            heart.innerText = 'â¤';
            // éšæœºä¸€ç‚¹åç§»
            const offset = Math.floor(Math.random() * 40) - 20;
            heart.style.left = `calc(50% + ${offset}px)`;
            heart.style.bottom = '100px';
            
            plantEl.appendChild(heart);
            setTimeout(() => heart.remove(), 1500);
        }

        // === å¯åŠ¨ ===
        setInterval(updateGame, 1000); // æ¯ç§’æ£€æŸ¥æ—¶é—´
        updateGame(); // ç«‹å³æ‰§è¡Œä¸€æ¬¡
        bugSystem(); // å¯åŠ¨è™«å­å¾ªç¯
    </script>
</body>
</html>
